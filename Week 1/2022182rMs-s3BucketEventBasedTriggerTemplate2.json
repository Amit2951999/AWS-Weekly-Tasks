{
	"AWSTemplateFormatVersion": "2010-09-09",
	"Description": "A template for event based trigger on S3 using Lmabda",
	"Resources": {
		"primaryS3bucket": {
			"Type": "AWS::S3::Bucket",
			"Properties": {
				"BucketName" : "primary-s3bucket1"
			}
		},
		
		"backupS3bucket": {
			"Type": "AWS::S3::Bucket",
			"Properties": {
				"BucketName": "backup-s3buckett1"
			}
		},
		
		"copyTrigger": {
			"Type": "AWS::Lambda::Function",
			"Properties": {
				"Code": { 
					"S3Bucket": "copy-trigger-lambda-func-bucket",
					"S3Key": "eventBasedTrigger.zip"
				},
				"Description": "This Function is called whenever an object lands on s3, to copy the object to another bucket",
				"Handler": "lambda_handler",
				"Role": "arn:aws:iam::478055296570:role/S3FullAccess",
				"Runtime" : "python3.9"
			}
		},
		
		"AllowS3ToCallLambdaPermission": {
			"Type": "AWS::Lambda::Permission",
			"DependsOn" : [ "primaryS3bucket", "copyTrigger" ],
			"Properties": {
				"Action": "lambda:InvokeFunction",  
				"FunctionName": { "Fn::GetAtt": [ "copyTrigger", "Arn"] },
				"Principal": "s3.amazonaws.com",
				"SourceArn":  { "Fn::GetAtt" : [ "primaryS3bucket", "Arn" ] }
			}
	    }
	}
}




